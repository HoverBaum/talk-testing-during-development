import { Head, Notes } from 'mdx-deck'

import myTheme from './lib/theme'
export const theme = myTheme

import CustomSplit from './lib/split.layout.js'
import Central from './lib/central.layout.js'

import Timeline from './components/timeline/timeline'
import Quote from './components/quote'
import BackgroundImage from './components/background-image'
import Legend from './components/legend'
import Center from './components/center'
import Counter from './components/counter'
import LargeImage from './components/largeImage'
import Impact from './components/impact'
import Credit from './components/credit'
import SlideHeadline from './components/slide-headline'
import Portrait from './components/portrait'
import OpeningSlide from './components/opening-slide'
import Interlude from './components/interlude'
import BackgroundBubbles from './components/background-bubbles'
import TableCaption from './components/table-caption'
import Wordcloud from './components/wordcloud'
import ModeImage from './components/mode-image'
import PrimaryColored from './components/primary-colored'

import splitTestingData from './scenarios/splitTesting'
import perfectTestingData from './scenarios/perfect'
import longTestingData from './scenarios/longTesting'

<!-- Import Images as a workaround for static files not working. -->
<!-- https://github.com/jxnblk/mdx-deck/issues/401 -->

import PortraitImage from './images/portrait.jpg'
import CypressExampleImage from './images/cypress-example.png'
import LegendImageMeetings from './images/meetings-calendar.png'
import LegendImageWorking from './images/working-2-construction.png'
import LegendImageTesting from './images/testing-detective.png'
import LegendImageReleasing from './images/releasing-rocket.png'
import DetectiveEmojiImage from './images/testing-detective.png'
import CypressLogoImage from './images/cypress-logo.png'
import CypressLogoWhiteImage from './images/cypress-logo-white.png'
import CypressCLIImage from './images/cypress-cli.png'

<Head>
  <title>Testing</title>
</Head>

<!-- Presentation start -->

<Central>

<OpeningSlide
  title="Web Apps don't need no manual testing 🧐"
  author='Hendrik Wallbaum'
/>

</Central>

<BackgroundBubbles />

---

<Central>

<OpeningSlide
  title="Web Apps don't need no manual testing 🧐"
  author='Hendrik Wallbaum'
/>

</Central>

---

<CustomSplit>

<Center>

<Portrait src={PortraitImage} />

</Center>

## <PrimaryColored>Hendrik</PrimaryColored>

Developer for fun 🎉

Consultant from <a href="https://netlight.com" target="_blank">Netlight</a>

</CustomSplit>

---

<OpeningSlide
  title={
    <span>
      The <PrimaryColored>why</PrimaryColored> and{' '}
      <PrimaryColored>how</PrimaryColored> of End-to-End testing for Web Apps.
    </span>
  }
/>

---

<SlideHeadline sectionTitle='Testing'>Why we do it</SlideHeadline>

<CustomSplit>

- Find bugs before users do
- Ensure we fulfill specification
- Help future developers

<Center>

<img src={DetectiveEmojiImage} alt='Detective Emoji' />

</Center>

</CustomSplit>

<Notes>
  Examples to show why how we test is important
  <br />
  Time investment
</Notes>

---

<Interlude text='Story time 📖' />

<Notes>I love to talk about personal experiences to convey motivation.</Notes>

---

<SlideHeadline sectionTitle='Story time'>Development tasks</SlideHeadline>

<Legend
  items={[
    {
      src: LegendImageMeetings,
      title: 'Meetings',
    },
    {
      src: LegendImageWorking,
      title: 'Implementation',
    },
    {
      src: LegendImageTesting,
      title: 'Manual testing',
    },
    {
      src: LegendImageReleasing,
      title: 'Releasing',
    },
  ]}
/>

<Notes>
  Most people meet every two weeks. Because "scrum" or "agile".
  <br />
  These are the processes / actions we will see.
</Notes>

---

<SlideHeadline sectionTitle='Story time'>My dream</SlideHeadline>

<Timeline data={perfectTestingData} />

---

<SlideHeadline sectionTitle='Story time'>Code Freeze</SlideHeadline>

<Timeline data={longTestingData} />

---

<SlideHeadline sectionTitle='Story time'>Manual Releases</SlideHeadline>

<Timeline data={splitTestingData} />

---

<SlideHeadline sectionTitle='Story time'>Time investment</SlideHeadline>

|        | Dev<sup>\*</sup> | Test<sup>\*</sup> | Meet<sup>\*</sup> | Releasing<sup>\*</sup> | Releases |
| ------ | ---------------- | ----------------- | ----------------- | ---------------------- | -------- |
| Freeze | 12               | 5                 | 2                 | 1                      | 1        |
| Manual | 14               | 2                 | 2                 | 2                      | 8        |

<TableCaption>* in days</TableCaption>

---

<SlideHeadline sectionTitle='Story time'>Time investment</SlideHeadline>

|        | Dev<sup>\*</sup> | Test<sup>\*</sup> | Meet<sup>\*</sup> | Releasing<sup>\*</sup> | Releases | Bugs   |
| ------ | ---------------- | ----------------- | ----------------- | ---------------------- | -------- | ------ |
| Freeze | 12               | 5                 | 2                 | 1                      | **1**    | 🐛🐛🐛 |
| Manual | 14               | 2                 | 2                 | 2                      | **8**    | 🐛🐛   |

<TableCaption>* in days</TableCaption>

---

<SlideHeadline sectionTitle='Story time'>Numbers</SlideHeadline>

High performing organizations:

- Deploy <PrimaryColored>200</PrimaryColored> times as often
- Have a <PrimaryColored>3</PrimaryColored> times lower change failure rate
- Recover <PrimaryColored>24</PrimaryColored> times faster from failures

<Credit
  credit='DevOps Report 2016'
  creditLink='https://puppet.com/system/files/2016-06/2016%20State%20of%20DevOps%20infographic.pdf'
/>

<Notes>
  Every good talk should backup their claims with some empirical evidence.
  <br />
  It is all about cycles.
</Notes>

---

<SlideHeadline sectionTitle='My dream'>New stats</SlideHeadline>

|        | Dev<sup>\*</sup> | Test<sup>\*</sup> | Meet<sup>\*</sup> | Releasing<sup>\*</sup> | Releases | Bugs   |
| ------ | ---------------- | ----------------- | ----------------- | ---------------------- | -------- | ------ |
| Freeze | 12               | 5                 | 2                 | 1                      | 1        | 🐛🐛🐛 |
| Manual | 14               | 2                 | 2                 | 2                      | 8        | 🐛🐛   |
| Dream  | 18               | 0                 | 2                 | 0                      | 200      | 🐛     |

<TableCaption>* in days</TableCaption>

<Notes>10 Releases per day. I think even less than a thrid of bugs.</Notes>

---

<SlideHeadline sectionTitle='My dream' />

<Timeline data={perfectTestingData} />

---

<SlideHeadline sectionTitle='My dream'>Required actors</SlideHeadline>

<Legend
  items={[
    {
      emoji: '👨‍💻',
      title: 'Developer',
    },
    {
      emoji: '🤖',
      title: 'Computer',
    },
    {
      emoji: '🧐',
      title: 'Tester / QA',
    },
  ]}
/>

---

<SlideHeadline sectionTitle='My dream'>The perfect day</SlideHeadline>

<p
style={{
    display: 'flex',
    justifyContent: 'space-around',
    width: '100%',
    margin: 0,
    marginBottom: '1rem'
  }}>

  <span style={{width: '33%', textAlign: 'center'}}>Developer</span>
  <span style={{width: '33%', textAlign: 'center'}}>Computer</span>
  <span style={{width: '33%', textAlign: 'center'}}>QA</span>
</p>

<Timeline
  data={[
    {
      types: ['development'],
    },
    {
      types: ['testing', 'release'],
    },
    {
      types: ['testing'],
    },
  ]}
/>

<Notes>
  In a perfect world I focus on coding while testing and release happen
  automated and in parallel to my work.
  <br />
  Meanwhile QA ensures quality.
</Notes>

---

<Interlude text='Use the right tool for the right job 🔧' />

---

<SlideHeadline sectionTitle='Testing'>ALL the things</SlideHeadline>

<Wordcloud
  options={{
    enableTooltip: false,
    deterministic: false,
    fontFamily: 'sans-serif',
    rotations: 0,
    fontSizes: [80, 150],
    padding: 10,
  }}
  words={[
    {
      text: 'End-To-End',
      value: 150,
    },
    {
      text: 'Unit',
      value: 50,
    },
    {
      text: 'Integration',
      value: 50,
    },
    {
      text: 'API',
      value: 10,
    },
    {
      text: 'Regressions',
      value: 10,
    },
    {
      text: 'Component',
      value: 10,
    },
  ]}
/>

---

<SlideHeadline sectionTitle='Cypress'>
  E2E and integration testing
</SlideHeadline>

<Center>

<ModeImage
  src={CypressLogoImage}
  darkSrc={CypressLogoWhiteImage}
  alt='Cypress Logo'
/>

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Example app</SlideHeadline>

<Center>

<Counter />

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Testcases</SlideHeadline>

1. Basic render 🎉
2. Counter logic 🧮
3. Message display 📜

---

<SlideHeadline sectionTitle='Cypress'>In action</SlideHeadline>

<LargeImage src={CypressExampleImage} />

<Notes>Life demo time.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>In action</SlideHeadline>

<LargeImage src={CypressCLIImage} />

---

<SlideHeadline sectionTitle='Cypress'>Setup</SlideHeadline>

```javascript
// Basic file structure some.spec.js.
/// <reference types="Cypress" />

describe('Some component', () => {
  it('should do something', () => {
    cy.doThings().assert('to.be', true)
  })

  it.only('Only this', () => {})
})
```

<Credit
  credit='Test Structure'
  creditLink='https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Test-Structure'
/>

<Notes>Check out the credit links for more information.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Setup</SlideHeadline>

cypress.json

```json
{
  "baseUrl": "http://localhost:8888"
}
```

<Credit
  credit='Cypress.json'
  creditLink='https://docs.cypress.io/api/cypress-api/config.html'
/>

<Notes>Check out the credit links for more information.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

1. Basic render 🎉

```javascript
it('should have a headline', () => {
  cy.visit('/')
  cy.get('h1')
})
```

<Notes>
  Can get elements and assert their presence. Cypress will retry for us.
</Notes>

<Credit
  credit='Cypress introduction'
  creditLink='https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

2. Counter logic 🧮

```javascript
it('should initially have a count of 0', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]').contains('0')
})
```

<Notes>
  Use data-testid to decouple tests from every day development.
  <br />
  We can find text within an element.
</Notes>

<Credit
  credit='Testids as a best practice'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html#Selecting-Elements'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

2. Counter logic 🧮

```javascript
it('should increment', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('1')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('2')
})
```

<Notes>
  Good tests check multiple / all cases.
  <br />
  We can interact with elements.
  <br />
  click, type, select, check
</Notes>

<Credit
  credit='Interacting with Elements'
  creditLink='https://docs.cypress.io/guides/core-concepts/interacting-with-elements.html#Actionability'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

3. Messsage display 📜

```javascript
it('should display message on click', () => {
  cy.visit('/')
  cy.get('[data-testid="button-display"]').click()
  cy.get('[data-testid="display"]')
})
```

<Notes>
  Can get() dynamically added elements. Cypress will retry this for you.
</Notes>

<Credit
  credit='Cypress retries commands'
  creditLink='https://docs.cypress.io/guides/core-concepts/retry-ability.html'
/>

---

<Interlude text='Beyond basics 🛫' />

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

```javascript
it('should increment from previous value', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]')
    .invoke('text')
    .then(text => {
      cy.get('[data-testid="button-increment"]').click()
      cy.get('[data-testid="count-output"]') //
        .contains(parseInt(text) + 1)
    })
})
```

<Credit
  credit='Cypress invoke'
  creditLink='https://docs.cypress.io/api/commands/invoke.html#Syntax'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

- Cypress returns Promise like values

- You can <PrimaryColored>not</PrimaryColored> `await` Cypress commands

- `.then()` to use values from previous commands

<Credit
  credit='Cypress Subject Management'
  creditLink='https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html#Subject-Management'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Fixtures

```javascript
it('should compare to fixture', () => {
  cy.visit('/')
  cy.fixture('data').then(dataFixture => {
    cy.get('.data-element').contains(dataFixture)
  })
})
```

<Notes>Fixtures are pre-defined datasets.</Notes>

<Credit
  credit='Cypress fixtures'
  creditLink='https://docs.cypress.io/api/commands/fixture.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Mocks and fixtures

```javascript
it('should mock requests', () => {
  cy.server()
  cy.route(/some\/regex/, 'fixture:response.json')
  cy.visit('/loads/data')
  cy.get('[data-testid="data"]')
})
```

<Credit
  credit='Fixtures for mocking'
  creditLink='https://docs.cypress.io/guides/guides/network-requests.html#Fixtures'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Aliases

```javascript
before(() => {
  cy.fixture('data').as('dataFixture')
})

it('should ...', function() {
  cy.get('element').contains(this.dataFixture)
})
```

<Notes>Aliases need the function keyword.</Notes>

<Credit
  credit='Cypress aliases'
  creditLink='https://docs.cypress.io/guides/core-concepts/variables-and-aliases.html#Return-Values'
/>

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

```javascript
cy.request({
  method: 'POST',
  url: 'https://your.domain',
  body: { password, username },
}).then(response => {
  expect(response.isOkStatusCode).to.be.true
  const id = response.body.id
  window.localStorage.setItem('id', id)
  // Cookies are set by Cypress
})
```

<Credit
  credit='Cypress best practices'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

Custom Commands

```javascript
Cypress.Commands.add('login', (username, password) => {
  // Login programmatically
})

// some.spec.js
beforeEach(() => {
  cy.login('username', 'password')
})
```

<Credit
  credit='Cypress best practices'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

- Consider what to E2E-test

- Expose APIs from your application

- `.get()` does not need positive assertions

- Speed up your tests by logging in programmatically

- Use [tasks](https://docs.cypress.io/api/commands/task.html#Syntax) and [reporters](https://docs.cypress.io/guides/tooling/reporters.html#Custom-Reporters)

- [More best practices](https://docs.cypress.io/guides/references/best-practices.html)

---

<SlideHeadline sectionTitle='Cypress'>Caveats</SlideHeadline>

- Mocking fetch requests is still difficult ([recipe](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/stubbing-spying__window-fetch#readme))

- Might need implementation just for tests

- For now only Chrome [#310](https://github.com/cypress-io/cypress/issues/310)

- Danger of Spaghetti code

---

<OpeningSlide
  title="Web Apps don't need no manual testing!?"
  title2='Or do they? 🤷‍♂️'
/>

---

<SlideHeadline sectionTitle='Presentation' />

Resources 📚

- [Cypress Guides](https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell)
- [Cypress API](https://docs.cypress.io/api/api/table-of-contents.html)
- [Examples](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples)
- [Repo for this presentation](https://github.com/HoverBaum/talk-testing-during-development)

---

<Interlude style={{ justifyContent: 'center' }} text='🏁 The End 🏁' />

---

<Interlude text='Questions? 🤔' />

Find my social media and blog on: [HendrikWallbaum.de](https://hendrikwallbaum.de)
