import { Head, Notes } from 'mdx-deck'
import { Split } from 'mdx-deck/layouts'

import CustomSplit from './lib/split.layout.js'
import Central from './lib/central.layout.js'

import Timeline from './components/timeline/timeline'
import Quote from './components/quote'
import BackgroundImage from './components/background-image'
import Legend from './components/legend'
import Center from './components/center'
import Counter from './components/counter'
import LargeImage from './components/largeImage'
import Impact from './components/impact'
import Credit from './components/credit'
import SlideHeadline from './components/slide-headline'
import Portrait from './components/portrait'
import Interlude from './components/interlude'
import OpeningSlide from './components/opening-slide'

<Interlude text='Use the right tool for the right job 🔧' />

---

<SlideHeadline sectionTitle='Cypress'>
  E2E and integration testing
</SlideHeadline>

<Center>

![Cypress logo](images/cypress-logo.png)

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Example app</SlideHeadline>

<Center>

<Counter />

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Testcases</SlideHeadline>

1. Basic render 🎉
2. Counter logic 🧮
3. Message display 📜

---

<SlideHeadline sectionTitle='Cypress'>In action</SlideHeadline>

<LargeImage src='images/cypress-example.png' />

<Notes>Life demo time.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Setup</SlideHeadline>

```javascript
// Basic file structure some.spec.js.

/// <reference types="Cypress" />

describe('Some component', () => {
  it('should do something', () => {
    cy.doThings().assert('to.be', true)
  })
})
```

<Credit
  credit='Test Structure'
  creditLink='https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Test-Structure'
/>

<Notes>Check out the credit links for more information.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Setup</SlideHeadline>

cypress.json

```json
{
  "baseUrl": "http://localhost:8888"
}
```

<Credit
  credit='Cypress.json'
  creditLink='https://docs.cypress.io/api/cypress-api/config.html'
/>

<Notes>Check out the credit links for more information.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

1. Basic render 🎉

```javascript
it('should have a headline', () => {
  cy.visit('/')
  cy.get('h1')
})
```

<Notes>
  Can get elements and assert their presence. Cypress will retry for us.
</Notes>

<Credit
  credit='Cypress introduction'
  creditLink='https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

1. Basic render 🎉

```javascript
it('should have the right headline', () => {
  cy.visit('/')
  cy.get('h1').contains('Testing page')
})
```

<Notes>We can find text within an element.</Notes>

<Credit
  credit='Cypress contains'
  creditLink='https://docs.cypress.io/api/commands/contains.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

2. Counter logic 🧮

```javascript
it('should initially have a count of 0', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]').contains('0')
})
```

<Notes>Use data-testid to decouple tests from every day development.</Notes>

<Credit
  credit='Testids as a best practice'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html#Selecting-Elements'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

2. Counter logic 🧮

```javascript
it('should increment', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('1')
})
```

<Notes>
  We can interact with elements.
  <br />
  click, type, select, check
</Notes>

<Credit
  credit='Interacting with Elements'
  creditLink='https://docs.cypress.io/guides/core-concepts/interacting-with-elements.html#Actionability'
/>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

2. Counter logic 🧮

```javascript
it('should increment multiple times', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('2')
})
```

<Notes>Good tests check multiple / all cases.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

3. Messsage display 📜

```javascript
it('should display message on click', () => {
  cy.visit('/')
  cy.get('[data-testid="button-display"]').click()
  cy.get('[data-testid=display]')
})
```

<Notes>
  Can get() dynamically added elements. Cypress will retry this for you.
</Notes>

<Credit
  credit='Cypress retries commands'
  creditLink='https://docs.cypress.io/guides/core-concepts/retry-ability.html'
/>

---

<Interlude text='Beyond the basics 🚀' />

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

What to run?

```javascript
it.only('should only run this', () => {})

it.skip('should skip this', () => {})
```

<Credit
  credit='Excluding and Including Tests'
  creditLink='https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Excluding-and-Including-Tests'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Using previous state

```javascript
it('should increment from previous value', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]')
    .invoke('text')
    .then(text => {
      cy.get('[data-testid="button-increment"]').click()
      cy.get('[data-testid="count-output"]').contains(parseInt(text) + 1)
    })
})
```

<Credit
  credit='Cypress invoke'
  creditLink='https://docs.cypress.io/api/commands/invoke.html#Syntax'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Cypress returns Promise like values.

You can **not** `await` Cypress commands.

Thus we need to chain `.then()` should we<br/>want to use values from previous commands.

<Credit
  credit='Cypress Subject Management'
  creditLink='https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html#Subject-Management'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Fixtures

```javascript
it('should compare to fixture', () => {
  cy.visit('/')
  cy.fixture('data').then(dataFixture => {
    cy.get('.data-element').contains(dataFixture)
  })
})
```

<Notes>Fixtures are pre-defined datasets.</Notes>

<Credit
  credit='Cypress fixtures'
  creditLink='https://docs.cypress.io/api/commands/fixture.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Mocks and fixtures

```javascript
it('should mock requests', () => {
  cy.server()
  cy.route(/some\/regex/, 'fixture:response.json')
  cy.visit('/loads/data')
  cy.get('[data-testid="data"]')
})
```

<Credit
  credit='Fixtures for mocking'
  creditLink='https://docs.cypress.io/guides/guides/network-requests.html#Fixtures'
/>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

Aliases

```javascript
before(() => {
  cy.fixture('data').as('dataFixture')
})

it('should ...', function() {
  cy.get('element').contains(this.dataFixture)
})
```

<Notes>Aliases need the function keyword.</Notes>

<Credit
  credit='Cypress aliases'
  creditLink='https://docs.cypress.io/guides/core-concepts/variables-and-aliases.html#Return-Values'
/>

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

Consider what to E2E-test.

Expose APIs from your application.

`.get()` does not need positive assertions.

Speed up your tests by logging in programmatically.

[More best practices](https://docs.cypress.io/guides/references/best-practices.html)

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

```javascript
cy.request({
  method: 'POST',
  url: 'https://your.domain',
  body: {
    password,
    username,
  },
}).then(response => {
  expect(response.isOkStatusCode).to.be.true
  const id = response.body.id
  window.localStorage.setItem('id', id)
  // Cookies are set by Cypress
})
```

<Credit
  credit='Cypress best practices'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Best Practices</SlideHeadline>

Custom Commands

```javascript
Cypress.Commands.add('login', (username, password) => {
  // Login programmatically
})

// some.spec.js
beforeEach(() => {
  cy.login('username', 'password')
})
```

<Credit
  credit='Cypress best practices'
  creditLink='https://docs.cypress.io/guides/references/best-practices.html'
/>

---

<SlideHeadline sectionTitle='Cypress'>Reporting</SlideHeadline>

```json
// cypress.json configuration.
{
  "baseUrl": "http://localhost:8888",
  "reporter": "junit",
  "reporterOptions": {
    "mochaFile": "results/test-results-[hash].xml"
  }
}
```

Cypress is build on Mocha and has acccess to all [build in reporters](https://mochajs.org/#reporters).

<Credit
  credit='Cypress reporter docs'
  creditLink='https://docs.cypress.io/guides/tooling/reporters.html#Custom-Reporters'
/>

<Notes>
  Good moment to mention cypress.json in general.
  <br />
  Also remember to delete the results folder before running tests.
</Notes>

---

<OpeningSlide
  title="Web Apps don't need no manual testing!?"
  title2='Or do they? 🤷‍♂️'
/>

---

<SlideHeadline sectionTitle='Presentation' />

Resources 📚

- [Cypress Guides](https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell)
- [Cypress API](https://docs.cypress.io/api/api/table-of-contents.html)
- [Examples](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples)
- [Repo for this presentation](https://github.com/HoverBaum/talk-testing-during-development)

---

<Interlude style={{ justifyContent: 'center' }} text='🏁 The End 🏁' />

---

<Interlude text='Questions? 🤔' />

Find my social media and blog on: [HendrikWallbaum.de](https://hendrikwallbaum.de)
