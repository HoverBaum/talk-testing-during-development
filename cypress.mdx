import { Head, Notes } from 'mdx-deck'
import { Split } from 'mdx-deck/layouts'

import CustomSplit from './lib/split.layout.js'
import Central from './lib/central.layout.js'

import Timeline from './components/timeline/timeline'
import Quote from './components/quote'
import BackgroundImage from './components/background-image'
import Legend from './components/legend'
import Center from './components/center'
import Counter from './components/counter'
import LargeImage from './components/largeImage'
import Impact from './components/impact'
import Credit from './components/credit'
import SlideHeadline from './components/slide-headline'
import Portrait from './components/portrait'
import Interlude from './components/interlude'

<Interlude text='🔧 Use the right tool for the right job' />

---

<SlideHeadline sectionTitle='Cypress'>
  e2e and integration testing
</SlideHeadline>

<Center>

![Cypress logo](images/cypress-logo.png)

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Example app</SlideHeadline>

<Center>

<Counter />

</Center>

---

<SlideHeadline sectionTitle='Cypress'>Testcases</SlideHeadline>

1. Basic render 🎉
2. Counter logic 🧮
3. Message display 📜

---

<SlideHeadline sectionTitle='Cypress'>In action</SlideHeadline>

<LargeImage src='images/cypress-example.png' />

<Notes>Life demo time.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Setup</SlideHeadline>

```javascript
// Basic file structure some.spec.js.

/// <reference types="Cypress" />

context('Some component', () => {
  it('should do something', () => {
    cy.doThings().assert('to.be', true)
  })
})
```

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 1. Basic render 🎉

```javascript
it('should have a headline', () => {
  cy.visit('/')
  cy.get('h1')
})
```

<Notes>Can get elements and assert their presence.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 1. Basic render 🎉

```javascript
it('should have the right headline', () => {
  cy.visit('/')
  cy.get('h1').contains('Testing page')
})
```

<Notes>We can find text within an element.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 2. Counter logic 🧮

```javascript
it('should initially have a count of 0', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]').contains('0')
})
```

<Notes>Use data-testid to decouple tests from every day development.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 2. Counter logic 🧮

```javascript
it('should increment', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('1')
})
```

<Notes>
  We can interact with elements.
  <br />
  click, type, select, check
</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 2. Counter logic 🧮

```javascript
it('should increment multiple times', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('2')
})
```

<Notes>Good tests check multiple / all cases.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Coding</SlideHeadline>

### 3. Messsage display 📜

```javascript
it('should display message on click', () => {
  cy.visit('/')
  cy.get('[data-testid="button-display"]').click()
  cy.get('[data-testid=display]')
})
```

<Notes>
  Can get() dynamically added elements. Cypress will retry this for you.
</Notes>

---

<Interlude text='🚀 Beyond the basics' />

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## What to run

Cypress provides ways to decide, which tests to run.

```javascript
it.only('should only run this', () => {})

it.skip('should skip this', () => {})
```

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Using previous state

```javascript
it('should increment from previous value', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]')
    .invoke('text')
    .then(text => {
      cy.get('[data-testid="button-increment"]').click()
      cy.get('[data-testid="count-output"]').contains(parseInt(text) + 1)
    })
})
```

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Cypress yields

Cypress yields values in a Promise like fashion.

You can **not** `await` Cypress commands

Thus we need to chain `.then()` should we<br/>want to use values from previous commands.

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Fixtures

```javascript
it('should compare to fixture', () => {
  cy.visit('/')
  cy.fixture('data').then(dataFixture => {
    cy.get('.data-element').contains(dataFixture)
  })
})
```

<Notes>Fixtures are pre-defined datasets.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Mocks and fixtures

```javascript
it('should mock requests', () => {
  cy.server()
  cy.route(/some\/regex/, 'fixture:response.json').as('getData')
  cy.visit('/loads/data')
  cy.get('[data-testid="data"]')
})
```

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Aliases

```javascript
before(() => {
  cy.fixture('data').as('dataFixture')
})

it('should ...', function() {
  cy.get('element').contains(this.dataFixture)
})
```

<Notes>Aliases need the function keyword.</Notes>

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Do it programmatically

```javascript
cy.request({
  method: 'POST',
  url: 'https://your.domain',
  body: {
    password,
    username
  }
}).then(response => {
  expect(response.isOkStatusCode).to.be.true
  const id = response.body.id
  window.localStorage.setItem('id', id)
  // Cookies are set by Cypress
})
```

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Custom Commands

```javascript
Cypress.Commands.add('login', (username, password) => {
  // Login programmatically
})

// some.spec.js
beforeEach(() => {
  cy.login('username', 'password')
})
```

---

<SlideHeadline sectionTitle='Cypress'>Advanced</SlideHeadline>

## Best Practices

Consider what to e2e-test.

Expose APIs from your application.

`.get()` does not need positive assertions.

Speed up your tests by logging in programmatically.

[More best practices](https://docs.cypress.io/guides/references/best-practices.html)

---

<SlideHeadline sectionTitle='Presentation' />

## Resources

- [Cypress Guides](https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell)
- [Cypress API](https://docs.cypress.io/api/api/table-of-contents.html)
- [Examples](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples)
- [Repo for this presentation](https://github.com/HoverBaum/talk-testing-during-development)

---

<Interlude
  style={{ justifyContent: 'center', borderBottom: 0 }}
  text='🏁 The End 🏁'
/>

---

<Interlude text='🤔 Questions?' />

Find my social media and blog through: [HendrikWallbaum.de](https://hendrikwallbaum.de)
