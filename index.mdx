export { theme } from './lib/theme'

import { Head, Notes } from 'mdx-deck'
import { Split } from 'mdx-deck/layouts'

import CustomSplit from './lib/split.layout.js'

import Timeline from './components/timeline/timeline'
import Quote from './components/quote'
import Wrapper from './components/wrapper'
import BackgroundImage from './components/background-image'
import Legend from './components/legend'
import Center from './components/center'
import Counter from './components/counter'
import LargeImage from './components/largeImage'
import Impact from './components/impact'
import Credit from './components/credit'

<Head>
  <title>Testing</title>
</Head>

<!-- Presentation start -->

# Testing Webapps ğŸ§

---

export default CustomSplit

![](images/portrait.jpg)

## Hendrik

Developer for fun ğŸ‰

---

export default CustomSplit

![](images/testing-detective.png)

## Testing

- Find bugs before users do
- Ensure we fulfil specification
- Help future developers

Time investment

<Notes>
  Examples to show why how we test is important
</Notes>

---

<BackgroundImage
  src="images/reading.jpg"
  credit="Photo by Picsea on Unsplash"
  creditLink="https://unsplash.com/photos/EQlTyDZRx7U?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText"
/>

<Impact onImage={true}>
  Story time
</Impact>

<Notes>
  I love to talk about personal experiences to convey motivation.
</Notes>

---

## Legend

<Legend
  items={[{
    src: '/images/meetings-calendar.png',
    title: 'Meetings'
  }, {
    src: '/images/working-2-construction.png',
    title: 'Work on product' 
  }, {
    src: '/images/testing-detective.png',
    title: 'Manual testing' 
  }, {
    src: '/images/releasing-rocket.png',
    title: 'Releasing software' 
  }]}
/>

<Notes>
  Most people meet every two weeks.
  Because "scrum" or "agile".<br/>
  These are the processes / actions we will see.
</Notes>

---

## Codefreeze

import longTestingData from './scenarios/longTesting'

<Wrapper>
  <Timeline
    data={longTestingData}
  />
</Wrapper>

---

## Manual Releases

import splitTestingData from './scenarios/splitTesting'

<Wrapper>
  <Timeline
    data={splitTestingData}
  />
</Wrapper>

--- 

| Dev | Test | Meet | Releasing | Releases |
| --- | --- | --- | --- | --- |
| 11 | 5 | 2 | 1 | 1 |
| 14 | 2 | 2 | 2 | 8 |

<Credit
  credit="Timeinvestment in days"
/>

---

| Dev | Test | Meet | Releasing | Releases | Bugs |
| --- | --- | --- | --- | --- | --- |
| 11 | 5 | 2 | 1 | **1** | ğŸ›ğŸ›ğŸ›ğŸ›ğŸ› | 
| 14 | 2 | 2 | 2 | **8** | ğŸ›ğŸ›| 

<Credit
  credit="Timeinvestment in days"
/>

---

<BackgroundImage
  src="images/cycle.jpg"
  credit="Photo by Jeff Fielitz on Unsplash"
  creditLink="https://unsplash.com/photos/60WxQTZ8iq8?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText"
/>

<Quote
  size="3"
  onImage
>
  IT IS ALL ABOUT CYCLES
</Quote>

---

## High performing organizations

- Deploy **200** times as often
- Have a **3** times lower change failure rate
- Recover **24** times faster from failures

<small style={{fontSize: '1rem', position: 'absolute', bottom: '1rem'}}>- <a style={{color: 'inherit'}} href="https://puppet.com/system/files/2016-06/2016%20State%20of%20DevOps%20infographic.pdf">DevOps Report 2016</a></small>

<Notes>
  Every good talk should backup their claims with some empirical evidence.
</Notes>

---

## Legend

<Legend
  items={[{
    src: '/images/perfect-day.png',
    title: 'Perfect day'
  }]}
/>

---

## My dream

import perfectTestingData from './scenarios/perfect'

<Wrapper>
  <Timeline
    data={perfectTestingData}
  />
</Wrapper>

---

| Dev | Test | Meet | Releasing | Releases | Bugs |
| --- | --- | --- | --- | --- | --- |
| 11 | 5 | 2 | 1 | 1 | ğŸ›ğŸ›ğŸ›ğŸ›ğŸ› | 
| 14 | 2 | 2 | 2 | 8 | ğŸ›ğŸ›| 
| 18 | 0 | 2 | 0 | 200 | ğŸ›| 

<Credit
  credit="Timeinvestment in days"
/>

<Notes>
  10 Releases per day. I think even less than a thrid of bugs.
</Notes>

---

## Actors

<Legend
  items={[{
    emoji: 'ğŸ‘¨â€ğŸ’»',
    title: 'Developer' 
  }, {
    emoji: 'ğŸ§',
    title: 'Tester / QA' 
  }, {
    emoji: 'ğŸ¤–',
    title: 'Computer' 
  }]}
/>

---

<h1
  style={{
    display: 'flex',
    justifyContent: 'space-around'
  }}><span>ğŸ‘¨â€ğŸ’»</span><span>ğŸ¤–</span><span>ğŸ§</span></h1>

<Timeline
  data={[{
    types: ['development']
  }, {
    types: ['testing', 'release']
  }, {
    types: ['testing']
  }]}
/>

<Notes>
  In a perfect world I focus on coding
  while testing and release happen automated
  and in parallel to my work.<br/>
  Meanwhile QA ensures quality.
</Notes>

---

# Testing ğŸ”§

---

<BackgroundImage
  src="images/tools.jpg"
  credit="Photo by Cesar Carlevarino Aragon on Unsplash"
  creditLink="https://unsplash.com/photos/NL_DF0Klepc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText"
/>

<Quote
  size="3"
  onImage
>
  Use the right tool for the right job
</Quote>

---

![Cypress logo](images/cypress-logo.png)

<Center>

e2e and integration testing

</Center>

---

<Counter/>

---

## Testcases

1. Basic render ğŸ‰
2. Counter logic ğŸ§®
3. Message display ğŸ“œ

---

<LargeImage
  src="images/cypress-example.png"
/>

<Notes>
Life demo time.
</Notes>

---

### Cypress setup

```javascript
// Basic file structure some.spec.js.

/// <reference types="Cypress" />

context('Some component', () => {

  it('should do something', () => {
    cy.doThings().assert('to.be', true)
  })

})
```

---

### 1. Basic render ğŸ‰

```javascript
it('should have a headline', () => {
  cy.visit('/')
  cy.get('h1')
})
```

<Notes>
  Can get elements and assert their presence.
</Notes>

---

### 1. Basic render ğŸ‰

```javascript
it('should have the right headline', () => {
  cy.visit('/')
  cy.get('h1')
    .contains('Testing page')
})
```

<Notes>
  We can find text within an element.
</Notes>

---

### 2. Counter logic ğŸ§®

```javascript
it('should initially have a count of 0', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]').contains('0')
})
```

<Notes>
  Use data-testid to decouple tests from every day development.
</Notes>

---

### 2. Counter logic ğŸ§®

```javascript
it('should increment', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('1')
})
```

<Notes>
  We can interact with elements.<br/>
  click, type, select, check
</Notes>

---

### 2. Counter logic ğŸ§®

```javascript
it('should increment multiple times', () => {
  cy.visit('/')
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="button-increment"]').click()
  cy.get('[data-testid="count-output"]').contains('2')
})
```

<Notes>
  Good tests check multiple / all cases.
</Notes>

---

### 3. Messsage display ğŸ“œ

```javascript
it('should display message on click', () => {
  cy.visit('/')
  cy.get('[data-testid="button-display"]').click()
  cy.get('[data-testid=display]')
})
```

<Notes>
  Can get() dynamically added elements. Cypress will retry this for you.
</Notes>

---

<BackgroundImage
  src="images/earth.jpg"
  credit="Photo by NASA on Unsplash"
  creditLink="https://unsplash.com/photos/Q1p7bh3SHj8?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText"
/>

<Impact onImage={true}>
  Beyond the basics
</Impact>

---

## What to run

Cypress provides ways to decide, which tests to run.

```javascript
it.only('should only run this', () => {})

it.skip('should skip this', () => {})
```

---

## Using previous state

```javascript
it('should increment from previous value', () => {
  cy.visit('/')
  cy.get('[data-testid="count-output"]')
    .invoke('text').then(text => {
      cy.get('[data-testid="button-increment"]').click()
      cy.get('[data-testid="count-output"]')
        .contains(parseInt(text) + 1)
    })
})
```

---

## Cypress yields

Cypress yields values in a Promise like fashion.

You can **not** `await` Cypress commands

Thus we need to chain `.then()` should we<br/>want to use values from previous commands.

---

## Fixtures

```javascript
it('should compare to fixture', () => {
  cy.visit('/')
  cy.fixture('data').then(dataFixture => {
    cy.get('.data-element')
      .contains(dataFixture)
  })
})
```

<Notes>
  Fixtures are pre-defined datasets.
</Notes>

---

## Mocks and fixtures

```javascript
it('should mock requests', () => {
  cy.server()
  cy.route(/some\/regex/, 'fixture:response.json')
    .as('getData')
  cy.visit('/loads/data')
  cy.get('[data-testid="data"]')
})
```

---

## Aliases

```javascript
before(() => {
  cy.fixture('data').as('dataFixture')
})

it('should ...', function() {
  cy.get('element').contains(this.dataFixture)
})
```

<Notes>
  Aliases need the function keyword.
</Notes>

---

## Do it programmatically

```javascript
cy.request({
  method: 'POST',
  url: 'https://your.domain',
  body: {
    password,
    username
  }
}).then(response => {
  expect(response.isOkStatusCode).to.be.true
  const id = response.body.id
  window.localStorage.setItem('id', id)
  // Cookies are set by Cypress
})
```

---

## Custom Commands

```javascript
Cypress.Commands.add('login', (username, password) => {
  // Login programmatically
})

// some.spec.js
beforeEach(() => {
  cy.login('username', 'password')
})
```

---

## Best Practices

Consider what to e2e-test.

Expose APIs from your application.

`.get()` does not need positive assertions.

Speed up your tests by logging in programmatically.

[More best practices](https://docs.cypress.io/guides/references/best-practices.html)

---

## Resources

- [Cypress Guides](https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell)
- [Cypress API](https://docs.cypress.io/api/api/table-of-contents.html)
- [Examples](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples)
- [Repo for this presentation](https://github.com/HoverBaum/talk-testing-during-development)

---

# ğŸ THE END ğŸ
